trigger:
  branches:
    include:
      - develop
      - main

pr:
  branches:
    include:
      - develop
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  node_version: '22.x'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '$(node_version)'
    displayName: 'ğŸ”§ Instalar Node.js'

  - script: |
      corepack enable
      yarn install --frozen-lockfile
    displayName: 'ğŸ“¦ Instalar dependÃªncias com Yarn'

  - script: |
      yarn lint
    displayName: 'ğŸ§¹ Rodar lint'

  - script: |
      yarn build
    displayName: 'ğŸ—ï¸ Build do projeto'

  - script: |
      yarn test
    displayName: 'ğŸ§ª Rodar testes unitÃ¡rios'

  - script: |
      yarn test:cov
    displayName: 'ğŸ“Š Cobertura de testes'

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/test-results.xml'
    condition: succeededOrFailed()
    displayName: 'ğŸ“ Publicar resultados de teste'
